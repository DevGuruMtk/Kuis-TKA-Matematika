```html
<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CBT Matematika</title>

<style>
body{
font-family:Segoe UI,Arial;
margin:0;
background:#eef2f7;
}

.header{
background:#1e3a8a;
color:#fff;
padding:15px;
text-align:center;
}

.card{
background:#fff;
margin:20px auto;
padding:20px;
border-radius:12px;
max-width:500px;
box-shadow:0 4px 10px rgba(0,0,0,0.1);
}

input{
width:100%;
padding:10px;
font-size:16px;
margin-bottom:12px;
border-radius:8px;
border:1px solid #ccc;
}

button{
width:100%;
padding:14px;
font-size:16px;
border:none;
border-radius:10px;
background:#2563eb;
color:#fff;
margin-top:10px;
cursor:pointer;
}

#kuis{display:none}

.layout{display:flex;height:100vh}

#navSoal{
width:80px;
background:#fff;
border-right:2px solid #ddd;
padding:5px;
}

#navSoal button{
width:50px;
margin:4px;
padding:8px;
background:#e5e7eb;
color:#000;
}

.dijawab{background:#22c55e!important;color:#fff}
.belum{background:#ef4444!important;color:#fff}

#konten{flex:1;padding:20px}
#timer{color:red;font-size:20px;font-weight:bold}

.boxSoal{
background:#fff;
padding:20px;
border-radius:12px;
box-shadow:0 2px 6px rgba(0,0,0,0.1);
max-width:650px;
}

.opsi{
display:flex;
align-items:center;
gap:14px;
padding:18px;
border:2px solid #e5e7eb;
border-radius:14px;
margin-bottom:14px;
cursor:pointer;
font-size:18px;
}

.opsi:hover{border-color:#2563eb}

.opsi.aktif{
border-color:#2563eb;
background:#eef4ff;
}

.huruf{
width:35px;
height:35px;
border-radius:50%;
background:#e5e7eb;
display:flex;
align-items:center;
justify-content:center;
font-weight:bold;
}

.opsi.aktif .huruf{
background:#2563eb;
color:#fff;
}
</style>
</head>

<body>

<div class="header">
<h1 id="judulSekolah">Latihan</h1>
<h2>CBT Matematika</h2>
</div>

<div id="awal" class="card">
Sekolah:
<input id="sekolah">
Nama:
<input id="nama">
Kelas:
<input id="kelas">
Absen:
<input id="absen">
<button onclick="mulai()">Mulai</button>
</div>

<div id="kuis">
<div class="layout">
<div id="navSoal"></div>

<div id="konten">
Waktu: <span id="timer"></span>
<div id="kotakSoal"></div>
<button onclick="nextSoal()">Next</button>
<button onclick="selesaiKuis()">Kirim</button>
</div>
</div>
</div>

<div id="halamanHasil"></div>

<script>
const URL="https://script.google.com/macros/s/AKfycby8JvqokqXYaE_GtrrEaEF_cRuUSwFBJ_tDS4ZLRUXrH5Iv-MnBTjKBxRL3Te363qw8jQ/exec";

let soal=[];
let ujianAktif=false;
let pelanggaran=0;

let index=0;
let jawaban=[];
let waktu=300;
let timerInt;

async function ambilSoal(){
  let res = await fetch(URL);
  let data = await res.json();

  soal = data.map(r => ({
    t: r.soal,
    p: [r.A, r.B, r.C, r.D],
    j: Number(r.kunci)
  }));

  if(soal.length===0){
    alert("Soal tidak ditemukan di spreadsheet");
    location.reload();
  }
}

async function mulai(){

if(!sekolah.value||!nama.value||!kelas.value||!absen.value){
alert("Isi data dulu");
return;
}

ujianAktif=true;
document.documentElement.requestFullscreen();

awal.style.display="none";
kuis.style.display="block";

await ambilSoal();
buatNav();
tampilSoal();
startTimer();
}

function buatNav(){
let h="";
for(let i=0;i<soal.length;i++){
h+=`<button id="b${i}" class="belum" onclick="lompat(${i})">${i+1}</button>`;
}
navSoal.innerHTML=h;
}

function tampilSoal(){
let s=soal[index];
let huruf=["A","B","C","D"];

let h=`<div class="boxSoal">
<b>Soal ${index+1}</b><br><br>${s.t}<br><br>`;

for(let i=0;i<s.p.length;i++){
let aktif=(jawaban[index]==i)?"aktif":"";
let checked=(jawaban[index]==i)?"checked":"";

h+=`
<label class="opsi ${aktif}">
<input type="radio" name="j" value="${i}" ${checked}>
<span class="huruf">${huruf[i]}</span>
<span>${s.p[i]}</span>
</label>`;
}

h+=`</div>`;
kotakSoal.innerHTML=h;

document.querySelectorAll('input[name="j"]').forEach((r,i)=>{
r.onchange=()=>{
jawaban[index]=i;
document.querySelectorAll(".opsi").forEach(o=>o.classList.remove("aktif"));
r.closest(".opsi").classList.add("aktif");
document.getElementById("b"+index).className="dijawab";
};
});
}

function nextSoal(){
if(jawaban[index]==undefined){alert("Pilih dulu");return;}
index++;
if(index>=soal.length){selesaiKuis();return;}
tampilSoal();
}

function lompat(n){index=n;tampilSoal();}

function formatWaktu(d){
let m=Math.floor(d/60);
let s=d%60;
return m+":"+(s<10?"0"+s:s);
}

function startTimer(){
timer.innerText = formatWaktu(waktu);

timerInt=setInterval(()=>{
waktu--;
timer.innerText=formatWaktu(waktu);

if(waktu<=0) selesaiKuisAuto();
},1000);
}

async function selesaiKuis(){
ujianAktif=false;
clearInterval(timerInt);

// hitung skor
let skor=0;
for(let i=0;i<soal.length;i++){
  if(jawaban[i]==soal[i].j) skor++;
}

try{
  await fetch(URL,{
  method:"POST",
  headers:{
    "Content-Type":"application/json"
  },
  body:JSON.stringify({
    sekolah: sekolah.value,
    nama: nama.value,
    kelas: kelas.value,
    absen: absen.value,
    skor: skor,
    tanggal: new Date().toLocaleString(),
    jawaban: jawaban.join("|")
  })
});

}catch(e){
console.log("Gagal kirim:",e);
alert("Data gagal dikirim. Periksa internet.");
}

tampilkanHasil(skor);
}

async function selesaiKuisAuto(){
ujianAktif=false;
clearInterval(timerInt);

let skor=0;
for(let i=0;i<soal.length;i++){
  if(jawaban[i]==soal[i].j) skor++;
}

try{
await fetch(URL,{
  method:"POST",
  headers:{
    "Content-Type":"application/json"
  },
  body:JSON.stringify({
    sekolah: sekolah.value,
    nama: nama.value,
    kelas: kelas.value,
    absen: absen.value,
    skor: skor,
    tanggal: new Date().toLocaleString(),
    jawaban: jawaban.join("|")
  })
});

}catch(e){
console.log("Gagal kirim:",e);
}

alert("Ujian dikirim otomatis");
tampilkanHasil(skor);
}

function tampilkanHasil(skor){
kuis.style.display="none";
halamanHasil.style.display="block";

halamanHasil.innerHTML=`
<h2>Skor ${skor}/${soal.length}</h2>
<button onclick="keluar()">Keluar</button>
`;
}

  function keluar(){
if(document.fullscreenElement) document.exitFullscreen();
location.reload();
}

/* ===== KUNCI ===== */
document.addEventListener("fullscreenchange",()=>{
if(ujianAktif && !document.fullscreenElement){
setTimeout(()=>document.documentElement.requestFullscreen(),100);
}
});

document.addEventListener("visibilitychange",()=>{
if(ujianAktif && document.hidden){
pelanggaran++;
if(pelanggaran>=1) selesaiKuisAuto();
}
});
document.addEventListener("keydown",function(e){
  if(e.key==="Escape" && ujianAktif){
    setTimeout(()=>{
      document.documentElement.requestFullscreen();
    },200);
  }
});

</script>
</body>
</html>
```



